if(typeof bbop=="undefined"){var bbop={}}if(typeof bbop.monarch=="undefined"){bbop.monarch={}}bbop.monarch.handler=function(){this._is_a="bbop.monarch.handler";var is_def=bbop.core.is_defined;if(!global_xrefs_conf){throw new Error("global_xrefs_conf is missing!")}this.mangle=bbop.core.uuid();this.string_to_function_map={};this.entries=0};bbop.monarch.handler.prototype.dispatch=function(data,name,context,fallback){var is_def=bbop.core.is_defined;var did=name||"";did+="_"+this.mangle;if(context){did+="_"+context}if(!is_def(this.string_to_function_map[did])){this.entries+=1;if(is_def(global_xrefs_conf[name])){var field_hash=global_xrefs_conf[name];var function_string=null;if(is_def(field_hash.context)&&is_def(field_hash.context[context])){function_string=field_hash.context[context]}else{if(is_def(field_hash["default"])){function_string=field_hash["default"]}}if(function_string==null){throw new Error("global_xrefs_conf appears to be damaged!")}var evalled_thing=eval(function_string);if(!is_def(evalled_thing)||evalled_thing==null||bbop.core.what_is(evalled_thing)!="function"){throw new Error('"'+function_string+'" did not resolve!')}else{this.string_to_function_map[did]=evalled_thing}}else{if(is_def(fallback)){this.string_to_function_map[did]=fallback}else{this.string_to_function_map[did]=null}}}var retval=null;if(this.string_to_function_map[did]!=null){var cfunc=this.string_to_function_map[did];retval=cfunc(data,name,context)}return retval};if(typeof bbop=="undefined"){var bbop={}}if(typeof bbop.monarch=="undefined"){bbop.monarch={}}bbop.monarch.linker=function(){this._is_a="bbop.monarch.linker";if(typeof global_app_base==="undefined"){throw new Error("we are missing access to global_app_base!")}this.app_base=global_app_base;this.generic_item={subject:true,object:true}};bbop.monarch.linker.prototype.url=function(id,xid,modifier,category){var retval=null;if(xid&&xid!=""){if(id&&id!=""){if(this.generic_item[xid]){if(typeof category==="undefined"){throw new Error("category is missing!")}else{if(category!="pathway"&&!(/^_/.test(id))){retval=this.app_base+"/"+category+"/"+id}}}}if(!retval&&id&&id!=""){if(!global_xrefs_conf){throw new Error("global_xrefs_conf is missing!")}var full_id_parts=bbop.core.first_split(":",id);if(full_id_parts&&full_id_parts[0]&&full_id_parts[1]){var src=full_id_parts[0];var sid=full_id_parts[1];var lc_src=src.toLowerCase();var xref=global_xrefs_conf[lc_src];if(xref&&xref.url_syntax){retval=xref.url_syntax.replace("[example_id]",sid,"g")}}}}return retval};bbop.monarch.linker.prototype.img=function(id,xid,modifier,category){var retval=null;if(xid&&xid!=""){if(!retval&&id&&id!=""){if(!global_xrefs_conf){throw new Error("global_xrefs_conf is missing!")}var full_id_parts=bbop.core.first_split(":",id);if(full_id_parts&&full_id_parts[0]&&full_id_parts[1]){var src=full_id_parts[0];var sid=full_id_parts[1];var lc_src=src.toLowerCase();var xref=global_xrefs_conf[lc_src];if(xref&&xref.image_path){retval='<img class="source" src="'+global_app_base+xref.image_path+'"/>'}}}}return retval};bbop.monarch.linker.prototype.anchor=function(args,xid,modifier){var anchor=this;var retval=null;if(args){var id=args.id;if(typeof id==="string"){retval=this.set_anchor(id,args,xid,modifier)}else{if(id instanceof Array){retval="";for(var i=0,l=id.length;i<l;i++){var anchor_tag=this.set_anchor(id[i],args,xid,modifier);if(anchor_tag){retval=retval+((retval)?", "+anchor_tag:anchor_tag)}}if(retval===""){retval=null}}}}return retval};bbop.monarch.linker.prototype.set_anchor=function(id,args,xid,modifier){var retval=null;var label=args.label;if(!label){label=id}var hilite=args.hilite;if(!hilite){hilite=label}var category=args.category;var url=this.url(id,xid,modifier,category);var img=this.img(id,xid,modifier,category);if(url){if(!retval&&img&&xid=="source-site"){retval='<a title="'+id+' (go to source page)" href="'+url+'">'+img+"</a>"}else{if(!retval&&img&&xid=="source"){retval='<a title="'+id+' (go to source page) " + href="'+url+'">'+id+"</a>"}else{if(!retval){hilite=hilite.replace(/\>/g,"&gt;");hilite=hilite.replace(/\</g,"&lt;");retval='<a title="'+id+" (go to the page for "+label+')" href="'+url+'">'+hilite+"</a>"}}}}return retval};if(typeof bbop=="undefined"){var bbop={}}if(typeof bbop.monarch=="undefined"){bbop.monarch={}}if(typeof bbop.monarch.widget=="undefined"){bbop.monarch.widget={}}bbop.monarch.widget.browse=function(server,manager,interface_id,in_argument_hash){var logger=new bbop.logger();logger.DEBUG=true;function ll(str){logger.kvetch("B (widget): "+str)}this._is_a="monarch.widget.browse";var anchor=this;var loop=bbop.core.each;var default_hash={info_button_callback:function(){},base_icon_url:null,image_type:"gif",current_icon:"this",info_icon:"info",info_alt:"Click for more information."};var folding_hash=in_argument_hash||{};var arg_hash=bbop.core.fold(default_hash,folding_hash);this._interface_id=interface_id;this._info_button_callback=arg_hash.info_button_callback;var base_icon_url=arg_hash.base_icon_url;var image_type=arg_hash.image_type;var current_icon=arg_hash.current_icon;var info_icon=arg_hash.info_icon;var info_alt=arg_hash.info_alt;this._current_acc=null;this.server=server;this.manager=manager;manager.register("success","do",draw_rich_layout);function draw_rich_layout(resp){var topo_graph=new bbop.model.bracket.graph();topo_graph.load_json(resp._raw);var anscestors=topo_graph.get_ancestor_subgraph("MP:0003675");var trans_graph=new bbop.model.graph();trans_graph.load_json(anscestors);var rich_layout=topo_graph.rich_bracket_layout(anchor._current_acc,trans_graph);var tl_attrs={"class":"bbop-js-ui-browse"};var top_level=new bbop.html.list([],tl_attrs);var nav_button_hash={};var info_button_hash={};var spacing="&nbsp;&nbsp;&nbsp;&nbsp;";var spaces=spacing;loop(rich_layout,function(layout_level){loop(layout_level,function(level_item){var nid=level_item[0];var lbl=level_item[1];var rel=level_item[2];var use_img_p=true;if(base_icon_url==null||base_icon_url==""){use_img_p=false}var nav_b=null;if(anchor._current_acc==nid){var inact_attrs={"class":"bbop-js-text-button-sim-inactive",title:"Current term."};nav_b=new bbop.html.span(nid,inact_attrs)}else{var tbs=bbop.widget.display.text_button_sim;var bttn_title="Reorient neighborhood onto this node ("+nid+").";nav_b=new tbs(nid,bttn_title);nav_button_hash[nav_b.get_id()]=nid}var info_b=null;if(use_img_p){var imgsrc=bbop.core.resourcify(base_icon_url,info_icon,image_type);info_b=new bbop.html.image({alt:info_alt,title:info_alt,src:imgsrc,generate_id:true})}else{info_b=new bbop.html.span("<b>[i]</b>",{generate_id:true})}info_button_hash[info_b.get_id()]=nid;var icon=null;if(use_img_p){var ialt="["+rel+"]";var isrc=null;if(anchor._current_acc==nid){isrc=bbop.core.resourcify(base_icon_url,current_icon,image_type)}else{isrc=bbop.core.resourcify(base_icon_url,rel,image_type)}icon=new bbop.html.image({alt:ialt,title:rel,src:isrc,generate_id:true})}else{if(anchor._current_acc==nid){icon="[[->]]"}else{if(rel&&rel.length&&rel.length>0){icon="["+rel+"]"}else{icon="[???]"}}}top_level.add_to(spaces,icon,nav_b.to_string(),lbl,info_b.to_string())});spaces=spaces+spacing});jQuery("#"+anchor._interface_id).empty();jQuery("#"+anchor._interface_id).append(top_level.to_string());loop(nav_button_hash,function(button_id,node_id){jQuery("#"+button_id).click(function(){var tid=jQuery(this).attr("id");var call_time_node_id=nav_button_hash[tid];anchor.draw_browser(call_time_node_id)})});loop(info_button_hash,function(button_id,node_id){jQuery("#"+button_id).click(function(){var tid=jQuery(this).attr("id");var call_time_node_id=info_button_hash[tid];var newurl="/phenotype/"+call_time_node_id;window.location.href=newurl})})}this.draw_browser=function(term_acc){anchor._current_acc=term_acc;var rsrc=this.server+"dynamic/browser.json?start_id="+term_acc+"&root_id=HP:0000118&relationship=subClassOf|partOf|isA";anchor.manager.resource(rsrc);anchor.manager.method("get");anchor.manager.jsonp_callback("callback");anchor.manager.update("search")}};